<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\sound\Audio.ts - Kiwi.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Kiwi.js"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.9</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AABB.html">AABB</a></li>
            
                <li><a href="../classes/Anim.html">Anim</a></li>
            
                <li><a href="../classes/Animation.html">Animation</a></li>
            
                <li><a href="../classes/ArcadePhysics.html">ArcadePhysics</a></li>
            
                <li><a href="../classes/Audio.html">Audio</a></li>
            
                <li><a href="../classes/AudioLibrary.html">AudioLibrary</a></li>
            
                <li><a href="../classes/AudioManager.html">AudioManager</a></li>
            
                <li><a href="../classes/Back.html">Back</a></li>
            
                <li><a href="../classes/Bar.html">Bar</a></li>
            
                <li><a href="../classes/BasicScore.html">BasicScore</a></li>
            
                <li><a href="../classes/Bootstrap.html">Bootstrap</a></li>
            
                <li><a href="../classes/Bounce.html">Bounce</a></li>
            
                <li><a href="../classes/Box.html">Box</a></li>
            
                <li><a href="../classes/Browser.html">Browser</a></li>
            
                <li><a href="../classes/Button.html">Button</a></li>
            
                <li><a href="../classes/Camera.html">Camera</a></li>
            
                <li><a href="../classes/CameraManager.html">CameraManager</a></li>
            
                <li><a href="../classes/Canvas.html">Canvas</a></li>
            
                <li><a href="../classes/CanvasRenderer.html">CanvasRenderer</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Circular.html">Circular</a></li>
            
                <li><a href="../classes/Clock.html">Clock</a></li>
            
                <li><a href="../classes/Common.html">Common</a></li>
            
                <li><a href="../classes/Component.html">Component</a></li>
            
                <li><a href="../classes/ComponentManager.html">ComponentManager</a></li>
            
                <li><a href="../classes/Counter.html">Counter</a></li>
            
                <li><a href="../classes/Cubic.html">Cubic</a></li>
            
                <li><a href="../classes/DataLibrary.html">DataLibrary</a></li>
            
                <li><a href="../classes/Device.html">Device</a></li>
            
                <li><a href="../classes/Elastic.html">Elastic</a></li>
            
                <li><a href="../classes/Entity.html">Entity</a></li>
            
                <li><a href="../classes/Exponential.html">Exponential</a></li>
            
                <li><a href="../classes/File.html">File</a></li>
            
                <li><a href="../classes/FileStore.html">FileStore</a></li>
            
                <li><a href="../classes/Finger.html">Finger</a></li>
            
                <li><a href="../classes/Game.html">Game</a></li>
            
                <li><a href="../classes/GameManager.html">GameManager</a></li>
            
                <li><a href="../classes/GameMath.html">GameMath</a></li>
            
                <li><a href="../classes/GLArrayBuffer.html">GLArrayBuffer</a></li>
            
                <li><a href="../classes/GLElementArrayBuffer.html">GLElementArrayBuffer</a></li>
            
                <li><a href="../classes/GLRenderer.html">GLRenderer</a></li>
            
                <li><a href="../classes/GLShaders.html">GLShaders</a></li>
            
                <li><a href="../classes/GLTexture.html">GLTexture</a></li>
            
                <li><a href="../classes/Group.html">Group</a></li>
            
                <li><a href="../classes/HUDDisplay.html">HUDDisplay</a></li>
            
                <li><a href="../classes/HUDManager.html">HUDManager</a></li>
            
                <li><a href="../classes/HUDWidget.html">HUDWidget</a></li>
            
                <li><a href="../classes/IChild.html">IChild</a></li>
            
                <li><a href="../classes/Icon.html">Icon</a></li>
            
                <li><a href="../classes/IconCounter.html">IconCounter</a></li>
            
                <li><a href="../classes/Input.html">Input</a></li>
            
                <li><a href="../classes/Intersect.html">Intersect</a></li>
            
                <li><a href="../classes/IntersectResult.html">IntersectResult</a></li>
            
                <li><a href="../classes/Key.html">Key</a></li>
            
                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
            
                <li><a href="../classes/Keycodes.html">Keycodes</a></li>
            
                <li><a href="../classes/Line.html">Line</a></li>
            
                <li><a href="../classes/Linear.html">Linear</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Manager.html">Manager</a></li>
            
                <li><a href="../classes/MasterClock.html">MasterClock</a></li>
            
                <li><a href="../classes/Matrix.html">Matrix</a></li>
            
                <li><a href="../classes/Menu.html">Menu</a></li>
            
                <li><a href="../classes/MenuItem.html">MenuItem</a></li>
            
                <li><a href="../classes/Mouse.html">Mouse</a></li>
            
                <li><a href="../classes/MouseCursor.html">MouseCursor</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Pointer.html">Pointer</a></li>
            
                <li><a href="../classes/Quadratic.html">Quadratic</a></li>
            
                <li><a href="../classes/Quartic.html">Quartic</a></li>
            
                <li><a href="../classes/Quintic.html">Quintic</a></li>
            
                <li><a href="../classes/RandomDataGenerator.html">RandomDataGenerator</a></li>
            
                <li><a href="../classes/Range.html">Range</a></li>
            
                <li><a href="../classes/Ray.html">Ray</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/RequestAnimationFrame.html">RequestAnimationFrame</a></li>
            
                <li><a href="../classes/Sequence.html">Sequence</a></li>
            
                <li><a href="../classes/Signal.html">Signal</a></li>
            
                <li><a href="../classes/SignalBinding.html">SignalBinding</a></li>
            
                <li><a href="../classes/SingleImage.html">SingleImage</a></li>
            
                <li><a href="../classes/Sinusoidal.html">Sinusoidal</a></li>
            
                <li><a href="../classes/Sound.html">Sound</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/SpriteSheet.html">SpriteSheet</a></li>
            
                <li><a href="../classes/Stage.html">Stage</a></li>
            
                <li><a href="../classes/State.html">State</a></li>
            
                <li><a href="../classes/StateConfig.html">StateConfig</a></li>
            
                <li><a href="../classes/StateManager.html">StateManager</a></li>
            
                <li><a href="../classes/StaticImage.html">StaticImage</a></li>
            
                <li><a href="../classes/Textfield.html">Textfield</a></li>
            
                <li><a href="../classes/TextField.html">TextField</a></li>
            
                <li><a href="../classes/TextureAtlas.html">TextureAtlas</a></li>
            
                <li><a href="../classes/TextureLibrary.html">TextureLibrary</a></li>
            
                <li><a href="../classes/Tile.html">Tile</a></li>
            
                <li><a href="../classes/TileMap.html">TileMap</a></li>
            
                <li><a href="../classes/TileMapLayer.html">TileMapLayer</a></li>
            
                <li><a href="../classes/TileType.html">TileType</a></li>
            
                <li><a href="../classes/Time.html">Time</a></li>
            
                <li><a href="../classes/Timer.html">Timer</a></li>
            
                <li><a href="../classes/TimerEvent.html">TimerEvent</a></li>
            
                <li><a href="../classes/Touch.html">Touch</a></li>
            
                <li><a href="../classes/Transform.html">Transform</a></li>
            
                <li><a href="../classes/Tween.html">Tween</a></li>
            
                <li><a href="../classes/Vector2.html">Vector2</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Animation.html">Animation</a></li>
            
                <li><a href="../modules/Components.html">Components</a></li>
            
                <li><a href="../modules/Easing.html">Easing</a></li>
            
                <li><a href="../modules/Files.html">Files</a></li>
            
                <li><a href="../modules/GameObjects.html">GameObjects</a></li>
            
                <li><a href="../modules/Geom.html">Geom</a></li>
            
                <li><a href="../modules/HUD.html">HUD</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/Kiwi.html">Kiwi</a></li>
            
                <li><a href="../modules/Renderers.html">Renderers</a></li>
            
                <li><a href="../modules/Sound.html">Sound</a></li>
            
                <li><a href="../modules/System.html">System</a></li>
            
                <li><a href="../modules/Textures.html">Textures</a></li>
            
                <li><a href="../modules/Tilemap.html">Tilemap</a></li>
            
                <li><a href="../modules/Time.html">Time</a></li>
            
                <li><a href="../modules/Tweens.html">Tweens</a></li>
            
                <li><a href="../modules/Utils.html">Utils</a></li>
            
                <li><a href="../modules/Widget.html">Widget</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\sound\Audio.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* Kiwi - Sound
* @module Kiwi
* @submodule Sound
* 
*/ 

module Kiwi.Sound {

    /**
    *
    *
    * @class Audio
    * @constructor
    * @param game {Game} The game that this piece of audio belongs to.
    * @param key {string} The key to which which piece of audio should be loaded from the AudioLibrary.
    * @param volume {number} A number between 0 (silence) and 1 (loud).
    * @param loop {boolean} If the audio should loop when it is finished or just stop.
    * @return {Audio} This object
    *
    */
    export class Audio {
         
        constructor(game: Kiwi.Game, key: string, volume: number, loop: boolean) {
            
            this._game = game;

            this._usingAudioTag = this._game.audio.usingAudioTag;
            this._usingWebAudio = this._game.audio.usingWebAudio; 

            if (this._game.audio.noAudio) return;

            if (!this._setAudio(key)) return;

            if (this._usingWebAudio) {
                this.context = this._game.audio.context;
                this.masterGainNode = this._game.audio.masterGain;

                //create our gain node
                if (this.context.createGain === &#x27;undefined&#x27;) {
                    this.gainNode = this.context.createGainNode();
                } else {
                    this.gainNode = this.context.createGain();
                }
                
                //make sure the audio is decoded.
                this._decode();

                this.gainNode.gain.value = volume * this._game.audio.volume;      //this may need to change.....
                this.gainNode.connect(this.masterGainNode); 
            } else if (this._usingAudioTag) {

                this.totalDuration = this._sound.duration;
                this._sound.volume = volume * this._game.audio.volume;

                if (isNaN(this.totalDuration)) this._pending = true;    //this should never need to happen once we get the loading clear.
            }

            this.duration = 0;
            this.volume = volume;
            this._muteVolume = volume;
            this._loop = loop;

            //add the default marker
            this.addMarker(&#x27;default&#x27;, 0, this.totalDuration, this._loop);
            this._currentMarker = &#x27;default&#x27;;

            //tonnes of signals to go here.
            this.onPlay = new Kiwi.Signal();
            this.onStop = new Kiwi.Signal();
            this.onPause = new Kiwi.Signal();
            this.onResume = new Kiwi.Signal();
            this.onLoop = new Kiwi.Signal();
            this.onMute = new Kiwi.Signal();

        }

        /**
        * The type of object that this is.
        * @method objType
        * @return {String}
        * @public
        */
        public objType() {
            return &quot;Audio&quot;;
        }

        /**
        * The game that this sound belongs to.
        * @property _game
        * @type Game
        * @private
        */
        private _game: Kiwi.Game;

        /**
        * Web Audio API ONLY - A reference to the audio context that the game&#x27;s audio manager has.
        * @property context
        * @type Any
        * @public
        */
        public context: any;
        
        /**
        * Web Audio API ONLY - A reference to the master gain node on the audio manager.
        * @property masterGainNode
        * @type Any
        * @public
        */
        public masterGainNode: any;

        /**
        * Web Audio API ONLY - This sounds local gainNode that it uses.
        * @property gainNode
        * @type Any
        * @public
        */
        public gainNode: any;

        /**
        * A boolean indicating whether or not that audio tags are being used to generate sounds.
        * @property _usingAudioTag
        * @type boolean
        * @private
        */
        private _usingAudioTag: boolean;

        /**
        * A boolean indicating whether or not the webAuduio api is being used. 
        * @property _usingWebAudio
        * @type boolean
        * @private
        */
        private _usingWebAudio: boolean;

        /**
        * A private indicator of whether this audio is currently muted or not.
        * @property _muted
        * @type boolean
        * @default false
        * @private
        */
        private _muted: boolean = false;  
        
        /**
        * A number between 0 and 1 representing the current volume of this audio piece. 
        * @property _volume
        * @type number
        * @default 1
        * @private
        */
        private _volume: number;  
        
        /**
        * A boolean indicating whether this piece of audio should loop or not.
        * @property _loop
        * @type boolean
        * @private
        */
        private _loop: boolean;

        /**
        * The key that was used to get the audio from the AudioLibrary.
        * @property key
        * @type string
        * @public
        */
        public key: string;
        
        /**
        * The property containing the file information about the audio.
        * @property _file
        * @type File
        * @private
        */
        private _file: Kiwi.Files.File;
        
        /**
        * This is the piece of audio that either method will use to play audio. E.g.
        * In the case of the Web Audio API this is the sound buffer source, in which the audio plays from. 
        * In the case of Audio Tags this is the Audio Tag itself.
        * @property _sound
        * @type Any
        * @private
        */
        private _sound: any;

        /**
        * A boolean that controls/knows if the audio is ready to be played or not.
        * This is just an indicator of if the file has been retrieved successfully from the file store or not.
        * @property ready
        * @type boolean
        * @public
        */
        public ready: boolean;

        /**
        * The total duration of the audio in seconds.
        * @property totalDuration
        * @type number
        * @public
        */
        public totalDuration: number = 0;
        
        /**
        * The current duration of the section of audio that is being played. In milliseconds.
        * @property duration
        * @type number
        * @public
        */
        public duration: number;
        
        /**
        * Web Audio API ONLY - The audio buffer that is to be used when playing audio segments.
        * @property _buffer
        * @type any
        * @private
        */
        private _buffer:any = null;

        /**
        * Web Audio API ONLY - A boolean to indicate if the audio has been decoded or not yet. If not you will need to run the decode() method.
        * @property _decoded
        * @type boolean
        * @default false
        * @private
        */
        private _decoded: boolean = false;

        /**
        * A private property that holds the volume before the sound was muted. Used so that when unmuted the sound will resume at its old spot.
        * @property _muteVolume
        * @type number
        * @private
        */
        private _muteVolume: number;

        /**
        * Indicates whether or not the sound is currently playing.
        * @property isPlaying
        * @type boolean
        * @default false
        * @public
        */
        public isPlaying: boolean;

        /**
        * A indicator of if the sound is currently paused.
        * @property paused
        * @type boolean
        * @default false
        * @public
        */
        public paused: boolean;

        /**
        * If the sound needs to be played but is waiting on something.
        * @property _pending
        * @type boolean
        * @private 
        */
        private _pending: boolean;

        /**
        * When the audio started playing. In milliseconds
        * @property _startTime
        * @type number
        * @private 
        */
        private _startTime: number;

        /**
        * When the audio is playing, this is the current time we are at with it playing. In milliseconds
        * @property _currentTime
        * @type number
        * @private.
        */
        private _currentTime: number;

        /**
        * The time at which the audio should stop playing. In milliseconds. This is assuming that the audio is not on loop.
        * @property _stopTime
        * @type number
        * @private
        */
        private _stopTime: number;

        /**
        * An array of all of the markers that are on this piece of audio. 
        * @property _markers
        * @type Array
        * @private
        */
        private _markers: any = [];

        /**
        * The current marker that is being used.
        * @property _currentMarker
        * @type String
        * @default &#x27;default&#x27;
        * @private
        */
        private _currentMarker: string = &#x27;default&#x27;;

        /**
        * A Kiwi Signal that dispatches a event when the audio starts playing.
        * @property onPlay
        * @type Signal
        * @public
        */
        public onPlay: Kiwi.Signal;

        /**
        * A Kiwi Signal that dispatches a event when the audio stops playing.
        * @property onStop
        * @type Signal
        * @public
        */
        public onStop: Kiwi.Signal;
        
        /**
        * A Kiwi Signal that dispatches a event when the audio gets paused.
        * @property onPause
        * @type Signal
        * @public
        */
        public onPause: Kiwi.Signal;
        
        /**
        * A Kiwi Signal that dispatches a event when the audio resumes.
        * @property onResume
        * @type Signal
        * @public
        */
        public onResume: Kiwi.Signal;
        
        /**
        * A Kiwi Signal that dispatches a event when the audio finishes and starts again, due to it looping.
        * @property onLoop
        * @type Signal
        * @public
        */
        public onLoop: Kiwi.Signal;
        
        /**
        * A Kiwi Signal that dispatches a event when the audio gets muted.
        * @property onMute
        * @type Signal
        * @public
        */
        public onMute: Kiwi.Signal;

        /**
        * Retrieves the audio data from the file store.
        * 
        * @method _setAudio
        * @param key {string} The key of the file that you are wanting to get.
        * @return {boolean}
        * @private
        */
        private _setAudio(key: string): boolean {
            if (key == &#x27;&#x27; || this._game.fileStore.exists(key) === false)
            {
                this.ready = false;
                return;
            }

            this.key = key;
            this._file = this._game.fileStore.getFile(key);
            this._sound = this._file.data;
            this.ready = true;

            return true;
        } 

        /**
        * Decodes the audio data to make it playable. By default the audio should already have been decoded when it was loaded.
        * 
        * @method _decode
        * @private
        */
        private _decode() {
            
            //you only decode when using the web audio api
            if (this._usingAudioTag || this._file.data.decode == false) return;

            //has the 
            if (this._file.data.decoded === true &amp;&amp; this._file.data.buffer !== null) {
                this._buffer = this._file.data.buffer;
                this._decoded = true;
                return;
            }

            var that = this;
            this.context.decodeAudioData(this._file.data.raw, function (buffer) {
                that._buffer = buffer;
                that._decoded = true;
            });

        }
        
        /**
        * Used to control the current volume for this sound.
        *
        * @property volume
        * @type number
        * @public
        */
        public set volume(val: number) {

            if (this._game.audio.noAudio) return;

            if (val !== undefined) {

                val = Kiwi.Utils.GameMath.clamp(val, 1, 0);

                this._volume = val;

                if (this._muted) {
                    this._muteVolume = this._volume;
                }

                if (this._usingWebAudio) {
                    this.gainNode.gain.value = this._volume * this._game.audio.volume;            //this may need to change....

                } else if (this._usingAudioTag) {
                    this._sound.volume = this._volume * this._game.audio.volume;

                }

            }
        }
        public get volume(): number {

            return this._volume;

        }

        /**
        * Allows you to mute the sound.
        *
        * @property mute
        * @type boolean
        * @public
        */
        public set mute(val: boolean) {

            if (this._game.audio.noAudio) return;

            if (val !== undefined &amp;&amp; this._muted !== val) {
                if (val === true) {
                    this._muteVolume = this._volume;
                    this.volume = 0;
                    this._muted = true;
                } else {
                    this._muted = false;
                    this.volume = this._muteVolume;
                }
                this.onMute.dispatch(this._muted);
            }
        }
        public get mute(): boolean {

            return this._muted;

        }

        /**
        * Adds a new marker to the audio which will then allow for that section of audio to be played.
        * 
        * @method addMarker
        * @param name {string} The name of the marker that you are adding.
        * @param start {number} The starting point of the audio. In seconds.
        * @param stop {number} The stopping point of the audio. In seconds.
        * @param [loop=false] {boolean} If the marker&#x27;s pieve of audio should loop or not.
        * @public 
        */
        public addMarker(name: string, start: number, stop: number, loop: boolean = false) {
            this._markers[name] = { start: start, stop: stop, duration: stop - start, loop: loop };
        }

        /**
        * Removes a currently existing marker from this audio.
        *
        * @method removeMarker
        * @param name {String} name of the audio that you want to remove.
        * @public
        */
        public removeMarker(name: string) {
            if (name === &#x27;default&#x27;) return; //cannot delete the default

            if (this.isPlaying &amp;&amp; this._currentMarker == name) {
                this.stop();    
                this._currentMarker = &#x27;default&#x27;;
            }
            delete this._markers[name];
        }


        /**
        * Plays the current sound/audio from the start.
        *
        * @method play
        * @param [marker] {string} The marker that is to be played. If no marker is specified then it will play the current marker (which would be the whole audio piece if no marker was ever added).
        * @param [forceRestart=false] {boolean} Force the audio to stop and start again. Otherwise if the audio was already playing it would ignore the play.
        * @public
        */
        public play(marker: string= this._currentMarker, forceRestart: boolean = false) {
            
            if (this.isPlaying &amp;&amp; forceRestart == false || this._game.audio.noAudio) return;

            if (forceRestart) this.stop();
            
            this.paused = false;

            if (this._markers[marker] == undefined) return;

            if(this._currentMarker === marker &amp;&amp; this.isPlaying) return;

            this._currentMarker = marker;
            this.duration = this._markers[this._currentMarker].duration * 1000;
            this._loop = this._markers[this._currentMarker].loop;

            if (this._usingWebAudio) {
                if (this._decoded === true) {

                    if (this._buffer == null) this._buffer = this._file.data.buffer;

                    this._sound = this.context.createBufferSource();
                    this._sound.buffer = this._buffer;
                    this._sound.connect(this.gainNode);
                    this.totalDuration = this._sound.buffer.duration;

                    if (this.duration == 0) this.duration = this.totalDuration * 1000;

                    if (this._loop) this._sound.loop = true;

                    //start
                    if (this._sound.start === undefined) {
                        this._sound.noteGrainOn(0, this._markers[this._currentMarker].start, this.duration / 1000);
                    } else {
                        this._sound.start(0, this._markers[this._currentMarker].start, this.duration / 1000);
                    }
                    
                    this.isPlaying = true;
                    this._startTime = this._game.time.now();
                    this._currentTime = 0;
                    this._stopTime = this._startTime + this.duration;
                    this.onPlay.dispatch();

                } else {
                    this._pending = true;
                    this._decode();
                }

            } else if(this._usingAudioTag) {
                
                if (this.duration == 0 || isNaN(this.duration)) this.duration = this.totalDuration * 1000;
                    
                if (this._muted) this._sound.volume = 0;
                else this._sound.volume = this._volume;
                
                this._sound.currentTime = this._markers[this._currentMarker].start;
                this._sound.play();
                this.isPlaying = true;
                this._startTime = this._game.time.now();
                this._currentTime = 0;
                this._stopTime = this._startTime + this.duration;

                if (!this.paused) this.onPlay.dispatch();
 
            }
        }

        /**
        * Stop the sound from playing.
        *
        * @method stop
        * @public
        */
        public stop() {

            if (this.isPlaying &amp;&amp; this._sound) {
                if (this._usingWebAudio) {

                    if (this._sound.stop === undefined) {
                        this._sound.noteOff(0);
                    } else {
                        this._sound.stop(0);
                    }

                } else if (this._usingAudioTag) {
                    this._sound.pause();
                    this._sound.currentTime = 0;
                }
                
                if(this.paused == false) this.onStop.dispatch();
            }

            this.isPlaying = false;
        }
        
        /**
        * Pauses the sound so that you can resume it from at point to paused it at.
        *
        * @method pause
        * @public
        */
        public pause() {
            if (this.isPlaying) {
                this.paused = true;
                this.stop();
                this.onPause.dispatch();
            }
        }
        
        /**
        * Plays the sound from when you paused the sound.
        *
        * @method resume
        * @public
        */
        public resume() {

            if (this.paused &amp;&amp; this.isPlaying == false) {
                if (this._usingWebAudio) {
                    
                    if (this._buffer == null) this._buffer = this._file.data.buffer;

                    this._sound = this.context.createBufferSource();
                    this._sound.buffer = this._buffer;
                    this._sound.connect(this.gainNode);
                    
                    if (this._sound.start === undefined) {
                        this._sound.noteGrainOn(0, this._markers[this._currentMarker].start + (this._currentTime / 1000), this.duration / 1000);
                    } else {
                        this._sound.start(0, this._markers[this._currentMarker].start + (this._currentTime / 1000), this.duration / 1000);
                    }

                } else {
                    this._sound.currentTime = this._markers[this._currentMarker].start + this._currentTime / 1000;
                    this._sound.play();
                }

                this.paused = false;
                this.isPlaying = true;
                this.onResume.dispatch();

            }

        }
        
        /**
        * The update loop that gets executed every frame. 
        * @method update
        * @public
        */
        public update() {
            //Check to see that the audio is ready
            if (!this.ready) return;

            //Is the audio ready to be played and was waiting?
            if (this._pending) {
                if (this._decoded === true || this._file.data.decoded) {
                    this._pending = false;
                    this.play();
                } else if (this._usingAudioTag &amp;&amp; !isNaN(this._sound.duration)) {
                    this.totalDuration = this._sound.duration;
                    this._markers[&#x27;default&#x27;].duration = this.totalDuration;
                    this._pending = false;      //again shouldn&#x27;t need once audio tag loader works.

                    if(this.isPlaying &amp;&amp; this._currentMarker == &#x27;default&#x27;) this.duration = this.totalDuration;
                }
            } 

            //if the audio is playing
            if (this.isPlaying) {

                this._currentTime = this._game.time.now() - this._startTime;
                
                if (this._currentTime &gt;= this.duration) {
                    if (this._usingWebAudio) {

                        if (this._loop) {

                            if (this._currentMarker == &#x27;default&#x27;) {
                                this._currentTime = 0;
                                this._startTime = this._game.time.now();
                            } else {
                                this.play(this._currentMarker, true);
                            }

                            this.onLoop.dispatch();
                        } else {
                            this.stop();
                        }

                    } else if(this._usingAudioTag) {

                        if (this._loop) {

                            this.play(this._currentMarker, true);
                            this.onLoop.dispatch();
                        } else {
                            this.stop();
                        }

                    }
                }
            }

        }
        
        /**
        * This method handles the destruction of all of the properties when the audio is no longer needed.
        * 
        * @method destroy
        * @public
        */
        public destroy() {
            delete this._sound;
            delete this._currentTime;
            delete this._startTime;
            delete this._stopTime;
            delete this._pending;
            delete this.masterGainNode;
            delete this.gainNode;
            delete this.totalDuration;
            delete this.duration;
            delete this._file;
            delete this._buffer;
            delete this._decoded;
        }

    }

}
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
