<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\file\File.ts - Kiwi.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Kiwi.js"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.4.9</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AABB.html">AABB</a></li>
            
                <li><a href="../classes/Anim.html">Anim</a></li>
            
                <li><a href="../classes/Animation.html">Animation</a></li>
            
                <li><a href="../classes/ArcadePhysics.html">ArcadePhysics</a></li>
            
                <li><a href="../classes/Audio.html">Audio</a></li>
            
                <li><a href="../classes/AudioManager.html">AudioManager</a></li>
            
                <li><a href="../classes/Bootstrap.html">Bootstrap</a></li>
            
                <li><a href="../classes/Box.html">Box</a></li>
            
                <li><a href="../classes/Browser.html">Browser</a></li>
            
                <li><a href="../classes/Camera.html">Camera</a></li>
            
                <li><a href="../classes/CameraManager.html">CameraManager</a></li>
            
                <li><a href="../classes/Canvas.html">Canvas</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Clock.html">Clock</a></li>
            
                <li><a href="../classes/Common.html">Common</a></li>
            
                <li><a href="../classes/Component.html">Component</a></li>
            
                <li><a href="../classes/ComponentManager.html">ComponentManager</a></li>
            
                <li><a href="../classes/DataLibrary.html">DataLibrary</a></li>
            
                <li><a href="../classes/Device.html">Device</a></li>
            
                <li><a href="../classes/Entity.html">Entity</a></li>
            
                <li><a href="../classes/File.html">File</a></li>
            
                <li><a href="../classes/FileStore.html">FileStore</a></li>
            
                <li><a href="../classes/Finger.html">Finger</a></li>
            
                <li><a href="../classes/Game.html">Game</a></li>
            
                <li><a href="../classes/GameManager.html">GameManager</a></li>
            
                <li><a href="../classes/GameMath.html">GameMath</a></li>
            
                <li><a href="../classes/Group.html">Group</a></li>
            
                <li><a href="../classes/IChild.html">IChild</a></li>
            
                <li><a href="../classes/Input.html">Input</a></li>
            
                <li><a href="../classes/Intersect.html">Intersect</a></li>
            
                <li><a href="../classes/IntersectResult.html">IntersectResult</a></li>
            
                <li><a href="../classes/Key.html">Key</a></li>
            
                <li><a href="../classes/Keyboard.html">Keyboard</a></li>
            
                <li><a href="../classes/Keycodes.html">Keycodes</a></li>
            
                <li><a href="../classes/Line.html">Line</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Manager.html">Manager</a></li>
            
                <li><a href="../classes/MasterClock.html">MasterClock</a></li>
            
                <li><a href="../classes/Matrix.html">Matrix</a></li>
            
                <li><a href="../classes/Mouse.html">Mouse</a></li>
            
                <li><a href="../classes/MouseCursor.html">MouseCursor</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Pointer.html">Pointer</a></li>
            
                <li><a href="../classes/RandomDataGenerator.html">RandomDataGenerator</a></li>
            
                <li><a href="../classes/Ray.html">Ray</a></li>
            
                <li><a href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a href="../classes/RequestAnimationFrame.html">RequestAnimationFrame</a></li>
            
                <li><a href="../classes/Sequence.html">Sequence</a></li>
            
                <li><a href="../classes/Signal.html">Signal</a></li>
            
                <li><a href="../classes/SignalBinding.html">SignalBinding</a></li>
            
                <li><a href="../classes/SingleImage.html">SingleImage</a></li>
            
                <li><a href="../classes/Sound.html">Sound</a></li>
            
                <li><a href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a href="../classes/SpriteSheet.html">SpriteSheet</a></li>
            
                <li><a href="../classes/Stage.html">Stage</a></li>
            
                <li><a href="../classes/State.html">State</a></li>
            
                <li><a href="../classes/StateConfig.html">StateConfig</a></li>
            
                <li><a href="../classes/StateManager.html">StateManager</a></li>
            
                <li><a href="../classes/StaticImage.html">StaticImage</a></li>
            
                <li><a href="../classes/Textfield.html">Textfield</a></li>
            
                <li><a href="../classes/TextureAtlas.html">TextureAtlas</a></li>
            
                <li><a href="../classes/TextureLibrary.html">TextureLibrary</a></li>
            
                <li><a href="../classes/Timer.html">Timer</a></li>
            
                <li><a href="../classes/Touch.html">Touch</a></li>
            
                <li><a href="../classes/Transform.html">Transform</a></li>
            
                <li><a href="../classes/Tween.html">Tween</a></li>
            
                <li><a href="../classes/Vector2.html">Vector2</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Animation.html">Animation</a></li>
            
                <li><a href="../modules/Components.html">Components</a></li>
            
                <li><a href="../modules/Files.html">Files</a></li>
            
                <li><a href="../modules/GameObjects.html">GameObjects</a></li>
            
                <li><a href="../modules/Geom.html">Geom</a></li>
            
                <li><a href="../modules/Input.html">Input</a></li>
            
                <li><a href="../modules/Kiwi.html">Kiwi</a></li>
            
                <li><a href="../modules/Sound.html">Sound</a></li>
            
                <li><a href="../modules/System.html">System</a></li>
            
                <li><a href="../modules/Textures.html">Textures</a></li>
            
                <li><a href="../modules/Time.html">Time</a></li>
            
                <li><a href="../modules/Tweens.html">Tweens</a></li>
            
                <li><a href="../modules/Utils.html">Utils</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\file\File.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
* Kiwi - Files
* @module Kiwi
* @submodule Files 
* 
*/
 
module Kiwi.Files {
     
    /**
    * Handles the loading of external data files via a tag loader or xhr + arraybuffer, and optionally saves to the file store.
    *
    * @class File
    *
    */
    export class File {

        /*
        * 
        * @constructor
        * @param {String} dataType
        * @param {String} path
        * @param {boolean} saveToFileStore
        * @return {Kiwi.Files}
        */
        constructor(game: Kiwi.Game, dataType: number, path: string, name: string = &#x27;&#x27;, saveToFileStore: boolean = true, storeAsGlobal:boolean = true) {

            this._game = game;

            this.dataType = dataType;

            this.fileURL = path;

            if (path.lastIndexOf(&#x27;/&#x27;) &gt; -1)
            {
                this.fileName = path.substr(path.lastIndexOf(&#x27;/&#x27;) + 1);
                this.filePath = path.substr(0, path.lastIndexOf(&#x27;/&#x27;) + 1);
            }
            else
            {
                this.filePath = &#x27;&#x27;;
                this.fileName = path;
            }

            //  Not safe if there is a query string after the file extension
            this.fileExtension = path.substr(path.lastIndexOf(&#x27;.&#x27;) + 1).toLowerCase();

            if (Kiwi.DEVICE.blob) {
                this._useTagLoader = true;
            } else {                
                this._useTagLoader = true;
            }

            if (this.dataType === Kiwi.Files.File.AUDIO) {
                if (this._game.audio.usingAudioTag === true) {
                    this._useTagLoader = true;
                } else { //just dont use the tag loader...just dont....
                    this._useTagLoader = false;
                }
            }

            if (this.dataType === Kiwi.Files.File.JSON) {
                this._useTagLoader = false; 
            }

            this._saveToFileStore = saveToFileStore;
            this._fileStore = this._game.fileStore;

            // null state owner indicates global storage
            if (this._game.states.current &amp;&amp; !storeAsGlobal) {
                this.ownerState = this._game.states.current;
            } else {
                this.ownerState = null;
            }

            if (this.key === &#x27;&#x27;)
            {
                this.key = this.fileName;
            }
            else
            {
                this.key = name;
            }


        }

        /**
        * Returns the type of this object
        */
        public objType() {
            return &quot;File&quot;;
        }


        // the state that added the entity - or null if it was added as global
        public ownerState: Kiwi.State;

        private _tags: string[];

        public addTag(tag: string) {
            if (this._tags.indexOf(tag) == -1) {
                this._tags.push(tag);
            }
        }

        public removeTag(tag: string) {
            var index: number = this._tags.indexOf(tag);
            if (index != -1) {
                this._tags.splice(index, 1);
            }
        }

        public hasTag(tag: string) {
            if (this._tags.indexOf(tag) == -1) {
                return false;
            }
            return true;

        }

        /**
        * @property IMAGE
        * @type number
    	*/
        public static IMAGE: number = 0;

        /**
        * @property SPRITE_SHEET
        * @type number
    	*/
        public static SPRITE_SHEET: number = 1;

        /**
        * @property TEXTUREATLAS
        * @type number
    	*/
        public static TEXTURE_ATLAS: number = 2;

        /**
        * @property AUDIO
        * @type number
	    */
        public static AUDIO: number = 3;

        /**
        * @property JSON
        * @type number
	    */
        public static JSON: number = 4;

        /**
        * @property XML
        * @type number
	    */
        public static XML: number = 5;

        /**
        * @property BINARY_DATA
        * @type number
	    */
        public static BINARY_DATA: number = 6;

        /**
        * @property TEXT_DATA
        * @type number
    	*/
        public static TEXT_DATA: number = 7;

        /**
        * @property _game
        * @type Kiwi.Game
        * @private
        */
        private _game: Kiwi.Game;

        /**
        * @property _xhr
        * @type XMLHttpRequest
        * @private
	    */
        private _xhr: XMLHttpRequest;

        /**
        * @property _fileStore
        * @type FileStore
        * @private
        */
        private _fileStore: Kiwi.Files.FileStore;

        /**
        * @property _saveToFileStore
        * @type boolean
        * @private
	    */
        private _saveToFileStore: boolean = true;

        /**
        * @property _useTagLoader
        * @type boolean
        * @private
	    */
        private _useTagLoader: boolean = true;

        /**
        * @property dataType
        * @type String
    	*/
        public dataType: number;

        /**
        * @property key
        * @type String
    	*/
        public key: string;

        /**
        * @property fileName
        * @type String
    	*/
        public fileName: string;

        /**
        * @property filePath
        * @type String
    	*/
        public filePath: string;

        /**
        * @property fileType
        * @type String
    	*/
        public fileType: string;

        /**
        * @property fileExtension
        * @type String
    	*/
        public fileExtension: string;

        /**
        * @property fileURL
        * @type String
    	*/
        public fileURL: string;

        /**
        * @property fileSize
        * @type Number
    	*/
        public fileSize: number = 0;

        /**
        * @property status
        * @type Number
    	*/
        public status: number = 0;

        /**
        * @property statusText
        * @type String
    	*/
        public statusText: string = &#x27;&#x27;;

        /**
        * @property ETag
        * @type String
    	*/
        public ETag: string = &#x27;&#x27;;

        /**
        * @property lastModified
        * @type String
    	*/
        public lastModified: string = &#x27;&#x27;;

        /**
        * @property totalSize
        * @type Number
    	*/
        public totalSize: number = 0;

        /**
        * @property bytesLoaded
        * @type Number
    	*/
        public bytesLoaded: number = 0;

        /**
        * @property bytesTotal
        * @type Number
    	*/
        public bytesTotal: number = 0;

        /**
        * @property readyState
        * @type Number
    	*/
        public readyState: number = 0;

        /**
        * @property timeOutDelay
        * @type Number
    	*/
        public timeOutDelay: number = 2000;

        /**
        * @property hasTimedOut
        * @type boolean
    	*/
        public hasTimedOut: boolean = false;

        /**
        * @property timedOut
        * @type Number
    	*/
        public timedOut: number = 0;

        //  Time the load started
        /**
        * @property timeStarted
        * @type Number
    	*/
        public timeStarted: number = 0;

        //  Time the load finished (if successful)
        /**
        * @property timeFinished
        * @type Number
    	*/
        public timeFinished: number = 0;

        //  How long the load took (in ms)
        /**
        * @property duration
        * @type Number
    	*/
        public duration: number = 0;

        /**
        * @property hasError
        * @type boolean
    	*/
        public hasError:  boolean = false;
        /**
        * @property success
        * @type boolean
    	*/
        public success: boolean = false;

        /**
        * @property attemptCounter
        * @type Number
    	*/
        public attemptCounter: number = 0;

        /**
        * @property maxLoadAttempts
        * @type Number
    	*/
        public maxLoadAttempts: number = 2;

        /**
        * @property error
        * @type Any
    	*/
        public error: any;

        /**
        * @property onCompleteCallback
        * @type Any
    	*/
        public onCompleteCallback: any = null;

        /**
        * @property onProgressCallback
        * @type Any
    	*/
        public onProgressCallback: any = null;

        /**
        * @property lastProgress
        * @type Number
    	*/
        public lastProgress: number = 0;

        /**
        * @property percentLoaded
        * @type Number
    	*/
        public percentLoaded: number = 0;

        /**
        * @property buffer
        * @type Any
    	*/
        public buffer: any;

        /**
        * @property data
        * @type Any
    	*/
        public data: any;

        /**
        * A dictionary, stores info needed for interpreting specific file types eg SPRITE_SHEET,
        * @property data
        * @type Any
    	*/
        public metadata: any;

        public get isTexture(): boolean {
            if (this.dataType === File.IMAGE || this.dataType === File.SPRITE_SHEET || this.dataType === File.TEXTURE_ATLAS) {
                return true;
            }
            return false;
        }
        
        public get isAudio(): boolean {
            if (this.dataType === File.AUDIO) {
                return true;
            }
            return false;
        }

        public get isData(): boolean {
            if (this.dataType === File.XML || this.dataType === File.JSON || this.dataType === File.TEXT_DATA || this.dataType === File.BINARY_DATA) {
                return true;
            }
            return false;
        }

        /**
        * @method load
        * @param {Any} [onCompleteCallback]
        * @param {Any} [onProgressCallback]
        * @param {Number} maxLoadAttempts
        * @param {Number} timeout
        */
        load(onCompleteCallback: any = null, onProgressCallback: any = null, customFileStore: Kiwi.Files.FileStore = null, maxLoadAttempts: number = 1, timeout: number = 2000) {

            this.onCompleteCallback = onCompleteCallback;
            this.onProgressCallback = onProgressCallback;
            this.maxLoadAttempts = maxLoadAttempts;
            this.timeOutDelay = timeout;

            if (customFileStore !== null)
            {
                this._fileStore = customFileStore;
                this._saveToFileStore = true;
            }

            this.start();

            if (this._useTagLoader === true)
            {
                this.tagLoader();
            }
            else
            {
                this.xhrLoader();
            }

        }

        /**
        * @method start
		*/
        private start() {

            this.timeStarted = Date.now();
            this.lastProgress = Date.now();
            this.percentLoaded = 0;

        }

        /**
        * @method stop
		*/
        private stop() {

            this.percentLoaded = 100;
            this.timeFinished = Date.now();
            this.duration = this.timeFinished - this.timeStarted;

        }

        /**
        * @method tagLoader
		*/
        private tagLoader() {

            if (this.dataType === Kiwi.Files.File.IMAGE || this.dataType === Kiwi.Files.File.SPRITE_SHEET || this.dataType === Kiwi.Files.File.TEXTURE_ATLAS)
            {
                this.data = new Image();
                this.data.src = this.fileURL;
                this.data.onload = (event) =&gt; this.tagLoaderOnLoad(event);
                this.data.onerror = (event) =&gt; this.tagLoaderOnError(event);        //To be remade
                this.data.onreadystatechange = (event) =&gt; this.tagLoaderOnReadyStateChange(event);
            

            } else if (this.dataType === Kiwi.Files.File.AUDIO) {

                    //if device == iOS.... do awesome stuff....

                this.data = new Audio();
                this.data.src = this.fileURL;
                this.data.preload = &#x27;auto&#x27;;
                this.data.onerror = (event) =&gt; this.tagLoaderOnError(event);
                this.data.addEventListener(&#x27;canplaythrough&#x27;, () =&gt; this.tagLoaderOnLoad(null), false); //never firing.?.?.?
                this.data.onload = (event) =&gt; this.tagLoaderOnLoad(event);
                this.data.load();
                this.data.volume = 0;
                this.data.play(); //force the browser to load by playing the audio........ 
            }
            
        }

        /**
        * @method tagLoaderOnReadyStateChange
        * @param {Any} event
		*/
        private tagLoaderOnReadyStateChange(event) {

        }

        /**
        * @method tagLoaderOnError
        * @param {Any}
		*/
        private tagLoaderOnError(event) {

            this.hasError = true;
            this.error = event;

            if (this.onCompleteCallback)
            {
                this.onCompleteCallback(this);
            }

        }

        private tagLoaderProgressThrough(event) {
            
            this.stop(); //hasn&#x27;t really stopped but oh well.

            if (this.onCompleteCallback) {
                this.onCompleteCallback(this);
            }
        }

        /**
        * @method tagLoaderOnLoad
        * @param {Any}
        */
        private tagLoaderOnLoad(event) {

            if (this.percentLoaded !== 100) { // a hacky fix for the audio
                 
                this.stop();

                if (this.dataType === Kiwi.Files.File.AUDIO) { //makes me sad
                    this.data.removeEventListener(&#x27;canplaythrough&#x27;, () =&gt; this.tagLoaderOnLoad(null)); // the remove event that won&#x27;t work :(
                    this.data.pause();
                    this.data.currentTime = 0;
                    this.data.volume = 1;
                }

                if (this._saveToFileStore === true)
                {
                    this._fileStore.addFile(this.key, this);
                }
                
                if (this.onCompleteCallback)
                {
                    this.onCompleteCallback(this);
                }

            }
        }

        /**
        * @method xhrLoader
		*/
        private xhrLoader() {

            this._xhr = new XMLHttpRequest();
            this._xhr.open(&#x27;GET&#x27;, this.fileURL, true);
            this._xhr.timeout = this.timeOutDelay;
            this._xhr.responseType = &#x27;arraybuffer&#x27;;

            this._xhr.onloadstart = (event) =&gt; this.xhrOnLoadStart(event);
            this._xhr.onload = (event) =&gt; this.xhrOnLoad(event);
            this._xhr.onprogress = (event) =&gt; this.xhrOnProgress(event);
            this._xhr.ontimeout = (event) =&gt; this.xhrOnTimeout(event);
            this._xhr.onabort = (event) =&gt; this.xhrOnAbort(event);
            this._xhr.onreadystatechange = (event) =&gt; this.xhrOnReadyStateChange(event);

            this._xhr.send();

        }

        /**
        * @method xhrOnReadyStateChange
        * @param {Any}
		*/
        private xhrOnReadyStateChange(event) {

            this.readyState = event.target.readyState;

            if (this.readyState === 4)
            {
                this.xhrOnLoad(event);
            }

        }

        /**
        * @method xhrOnLoadStart
        * @param {Any}
		*/
        private xhrOnLoadStart(event) {

            this.timeStarted = event.timeStamp;
            this.lastProgress = event.timeStamp;

        }

        /**
        * @method xhrOnAbort
        * @param {Any}
		*/
        private xhrOnAbort(event) {

        }

        /**
        * @method xhrOnError
        * @param {Any}
		*/
        private xhrOnError(event) {

        }

        /**
        * @method xhrOnTimeout
        * @param {Any}
		*/
        private xhrOnTimeout(event) {

        }

        /**
        * @method xhrOnProgress
        * @param {Any}
		*/
        private xhrOnProgress(event) {

            this.bytesLoaded = parseInt(event.loaded);
            this.bytesTotal = parseInt(event.totalSize);
            this.percentLoaded = Math.round((this.bytesLoaded / this.bytesTotal) * 100);

            if (this.onProgressCallback)
            {
                this.onProgressCallback(this);
            }

        }

        /**
         * Once the file has finished downloading (or pulled from the browser cache) this onload event fires.
         * @method xhrOnLoad
         * @param {event} The XHR event
         **/
        private xhrOnLoad(event) {

            //  Probably hitting from the readyState as well
            if (this.timeFinished &gt; 0)
            {
                return;
            }

            this.stop();

            this.status = this._xhr.status;
            this.statusText = this._xhr.statusText;

            if (this._xhr.status === 200)
            {
                this.success = true;
                this.hasError = false;
                this.fileType = this._xhr.getResponseHeader(&#x27;Content-Type&#x27;);
                this.bytesTotal = parseInt(this._xhr.getResponseHeader(&#x27;Content-Length&#x27;));
                this.lastModified = this._xhr.getResponseHeader(&#x27;Last-Modified&#x27;);
                this.ETag = this._xhr.getResponseHeader(&#x27;ETag&#x27;);
                this.buffer = this._xhr.response;

                if (this.dataType === Kiwi.Files.File.IMAGE || this.dataType === Kiwi.Files.File.SPRITE_SHEET || this.dataType === Kiwi.Files.File.TEXTURE_ATLAS)
                {
                    this.createBlob();
                }
                else
                {
                    if (this.dataType === Kiwi.Files.File.JSON) {
                        this.data = String.fromCharCode.apply(null, new Uint8Array(this._xhr.response));
                        this.parseComplete();
                    }
                    
                    if (this.dataType === Kiwi.Files.File.AUDIO) {

                        if (this._game.audio.usingWebAudio) {
                            this.data = {
                                raw: this._xhr.response,
                                decoded: false,
                                buffer: null
                            }

                            //decode that audio
                            var that = this;
                            this._game.audio.context.decodeAudioData(this.data.raw, function (buffer) {
                                if (buffer) {
                                    that.data.buffer = buffer;
                                    that.data.decoded = true;
                                    that.parseComplete();
                                }
                            });

                        }
                    }
                    
                   
                }
            }
            else
            {
                this.success = false;
                this.hasError = true;
                this.parseComplete();
            }

        }

        /**
        * @method createBlob
		*/
        private createBlob() {

            this.data = document.createElement(&#x27;img&#x27;);
            this.data.onload = () =&gt; this.revoke();

            var imageType = &#x27;&#x27;;

            if (this.fileExtension === &#x27;jpg&#x27; || this.fileExtension === &#x27;jpeg&#x27;)
            {
                imageType = &#x27;image/jpeg&#x27;;
            }
            else if (this.fileExtension === &#x27;png&#x27;)
            {
                imageType = &#x27;image/png&#x27;;
            }
            else if (this.fileExtension === &#x27;gif&#x27;)
            {
                imageType = &#x27;image/gif&#x27;;
            }

            //  Until they fix the TypeScript lib.d we have to use window array access

            //  Need to find a way to tell if this suports constuctor values like below, otherwise it just errors Chrome &lt; 20 etc
            //if (typeof window[&#x27;Blob&#x27;] !== &#x27;undefined&#x27;)
            //{
                var blob = new window[&#x27;Blob&#x27;]([this.buffer], { type: imageType });
            //}
            //else
            //{
                //var BlobBuilder = window[&#x27;BlobBuilder&#x27;] || window[&#x27;WebKitBlobBuilder&#x27;] || window[&#x27;MozBlobBuilder&#x27;] || window[&#x27;MSBlobBuilder&#x27;];
                //var builder = new BlobBuilder;
                //builder.append([this.buffer]); // needs appendABV check
                //var blob = builder.getBlob(imageType);
            //}

            if (window[&#x27;URL&#x27;])
            {
                this.data.src = window[&#x27;URL&#x27;].createObjectURL(blob);
            }
            else if (window[&#x27;webkitURL&#x27;])
            {
                this.data.src = window[&#x27;webkitURL&#x27;].createObjectURL(blob);
            }

        }

//var appendABViewSupported;

//	    private isAppendABViewSupported() {
//		if (typeof appendABViewSupported == &quot;undefined&quot;) {
//			var blobBuilder;
//			blobBuilder = new BlobBuilder();
//			blobBuilder.append(getDataHelper(0).view);
//			appendABViewSupported = blobBuilder.getBlob().size == 0;
//		}
//		return appendABViewSupported;
//	}

        /**
        * @method revoke
		*/
        private revoke() {

            if (window[&#x27;URL&#x27;])
            {
                window[&#x27;URL&#x27;].revokeObjectURL(this.data.src);
            }
            else if (window[&#x27;webkitURL&#x27;])
            {
                window[&#x27;webkitURL&#x27;].revokeObjectURL(this.data.src);
            }

            this.parseComplete();

        }

        /**
        * @method parseComplete
		*/
        private parseComplete() {

            if (this._saveToFileStore === true)
            {
                this._fileStore.addFile(this.key, this);
            }

            if (this.onCompleteCallback)
            {
                this.onCompleteCallback(this);
            }

        }

        /**
         * Get information about the given file
         * @method getFileDetails
         * @param {function} The callback to send this FileInfo object to
         **/
        getFileDetails(callback: any = null, maxLoadAttempts:number = 1, timeout: number = 2000) {

            this.onCompleteCallback = callback;
            this.maxLoadAttempts = maxLoadAttempts;
            this.timeOutDelay = timeout;

            this.sendXHRHeadRequest();

        }

        /**
        * 
        * @method sendXHRHeadRequest
        */
        private sendXHRHeadRequest() {

            this.attemptCounter++;

            this._xhr = new XMLHttpRequest();
            this._xhr.open(&#x27;HEAD&#x27;, this.fileURL, false);
            this._xhr.onload = (event) =&gt; this.getXHRResponseHeaders(event);
            this._xhr.ontimeout = (event) =&gt; this.xhrHeadOnTimeout(event);
            this._xhr.onerror = (event) =&gt; this.xhrHeadOnError(event);
            this._xhr.timeout = this.timeOutDelay;
            this._xhr.send();

        }

        /**
        * 
        * @method xhrHeadOnTimeout
        */
        private xhrHeadOnTimeout(event) {

            this.hasTimedOut = true;
            this.timedOut = Date.now();

            if (this.attemptCounter &gt;= this.maxLoadAttempts)
            {
                this.hasError = true;
                this.error = event;

                if (this.onCompleteCallback)
                {
                    this.onCompleteCallback.call(this);
                }
            }
            else
            {
                this.sendXHRHeadRequest();
            }

        }

        /**
        * 
        * @method xhrHeadOnError
        * @parm {Any} event
        */
        private xhrHeadOnError(event) {

            this.hasError = true;
            this.error = event;
            this.status = this._xhr.status;
            this.statusText = this._xhr.statusText;

            if (this.onCompleteCallback)
            {
                this.onCompleteCallback(this);
            }

        }

        /**
         * Process the response headers received
         * @method getResponseHeaders
         * @param {event} The XHR event
         * @param {function} The callback to send this FileInfo object to
         * @return {Kiwi.Loaders.FileInfo} This FileInfo object containing the results of the response
         **/
        private getXHRResponseHeaders(event:any) {

            this.status = this._xhr.status;
            this.statusText = this._xhr.statusText;

            if (this._xhr.status === 200)
            {
                this.fileType = this._xhr.getResponseHeader(&#x27;Content-Type&#x27;);
                this.fileSize = parseInt(this._xhr.getResponseHeader(&#x27;Content-Length&#x27;));
                this.lastModified = this._xhr.getResponseHeader(&#x27;Last-Modified&#x27;);
                this.ETag = this._xhr.getResponseHeader(&#x27;ETag&#x27;);
            }
                
            if (this.onCompleteCallback)
            {
                this.onCompleteCallback(this);
            }

        }

      

      
	    /**
	     * Returns a string representation of this object.
	     * @method toString
	     * @return {string} a string representation of the instance.
	     **/
        toString(): string {

            return &quot;[{File (fileURL=&quot; + this.fileURL + &quot; fileName=&quot; + this.fileName + &quot; dataType=&quot; + this.dataType + &quot; fileSize=&quot; + this.fileSize + &quot; success=&quot; + this.success + &quot; status=&quot; + this.status + &quot;)}]&quot;;

        }

    }

}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
